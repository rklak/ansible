- hosts: localhost
  connection: local
  become: True
  become_user: root
  become_method: sudo  
  pre_tasks:
    - name: Add copyq apt repository
      apt_repository:
        repo: ppa:hluk/copyq

    - name: Install dependecies
      tags: now
      apt:
        name:
          - cbatticon #battery indicator
          - copyq
          - coreutils #timeout
          - elixir
          - eza
          - fd-find
          - feh
          - flameshot
          - git
          - gimp
          - i3lock
          - keychain
          - light
          - pavucontrol
          - picom
          - redshift
          - x11-xkb-utils #keyboard pl
          - xclip
          - tmux
          - vim
          
    - name: Brew> Install prereq deb packages for
      apt:
        name: "{{ packages }}"
        state: present
      vars:
        packages:
          - build-essential
          - curl
          - file
          - git
          - procps 
          - locales
          - language-pack-en

    - name: Brew> Temporary directory
      ansible.builtin.file:
        path: "{{ linuxbrew_install_tmp }}"
        state: directory
        mode: 0700
      become: false

    - name: Brew> Download Homebrew install script
      ansible.builtin.get_url:
        url: "{{ linuxbrew_install_url }}"
        dest: "{{ linuxbrew_install_tmp }}/install.sh"
        checksum: "{{ linuxbrew_install_checksum | default(omit) }}"
        mode: 0700
      become: false

    - name: Brew> Install Homebrew with the installer
      ansible.builtin.command: sh -c "{{ linuxbrew_install_tmp }}/install.sh"
      register: install_result
      changed_when: "install_result.rc == 0"
      become: false

    - name: Brew> Remove temporary directory
      ansible.builtin.file:
        path: "{{ linuxbrew_install_tmp }}"
        state: absent
      become: false

    - name: Brew> Ensure taps are added
      homebrew_tap:
        name: "{{ item }}"
        state: present
        path: "{{ linuxbrew_prefix_shared }}/bin"
      loop:
        - jesseduffield/lazydocker
        - knqyf263/pet
        - jesseduffield/lazygit
      become: false
          
    - name: Install Formula
      community.general.homebrew:
        name: 
          - bat
          - chezmoi  
          - entr
          - ripgrep
          - lazydocker
          - pet
          - git-delta
          - lazygit
          - pgcli
          - xsv
          - neovim
          - tmux
          - tmuxinator
          - httpie
          - diff-so-fancy
          - tree
          - tlrc
        state: present
        path: "{{ linuxbrew_prefix_shared }}/bin"
      become: false

    - name: Clone i3-volume
      git:
        repo: https://github.com/hastinbe/i3-volume.git
        dest: "{{ i3_volume_path }}"
        clone: yes
        update: no

    - name: Clone tmux-scripts
      git:
        repo: https://github.com/rklak/tmux-scripts.git
        dest: "{{ scripts_path }}"
        clone: yes
        update: no

  roles:
    - vonmecheln.vivaldi
    - geerlingguy.docker
    - role: gantsign.oh-my-zsh
      users:
        - username: radoslaw-klak

  vars:
    docker_install_compose: true     
    linuxbrew_prefix_shared: "/home/linuxbrew/.linuxbrew"
    linuxbrew_use_installer: true
    linuxbrew_install_tmp: "/tmp/linuxbrew"
    linuxbrew_install_url: "https://raw.githubusercontent.com/Homebrew/install/master/install.sh"
    i3_volume_path: "/home/radoslaw-klak/i3-volume"
    scripts_path: "/home/radoslaw-klak/scripts"
